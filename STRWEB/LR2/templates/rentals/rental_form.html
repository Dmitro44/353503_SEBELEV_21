{% extends 'base.html' %}
{% load static %}

{% block title %}{% if is_update %}Изменение аренды{% else %}Новая аренда{% endif %} - Автопрокат{% endblock %}

{% block content %}
<div class="rental-form-container">
    <div class="rental-form-header">
        <h3>{% if is_update %}Изменение аренды{% else %}Новая аренда{% endif %}</h3>
    </div>
    <form method="post" novalidate>
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.vehicle.id_for_label }}" class="form-label">{{ form.vehicle.label|default:"Автомобиль" }}</label>
            {{ form.vehicle }}
            {% if form.vehicle.help_text %}
                <div class="form-text">{{ form.vehicle.help_text }}</div>
            {% endif %}
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="{{ form.rental_days.id_for_label }}" class="form-label">{{ form.rental_days.label|default:"Количество дней" }}</label>
                {{ form.rental_days }}
                {% if form.rental_days.help_text %}
                    <div class="form-text">{{ form.rental_days.help_text }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="{{ form.promo_code.id_for_label }}" class="form-label">{{ form.promo_code.label|default:"Промокод" }}</label>
                {{ form.promo_code }}
                {% if form.promo_code.help_text %}
                    <div class="form-text">{{ form.promo_code.help_text }}</div>
                {% endif %}
            </div>
        </div>

        <div class="price-calculation-section">
            <h5>Расчет стоимости</h5>
            <div id="price-breakdown"></div>
            <h3 id="calculated-price">Выберите автомобиль и укажите количество дней</h3>
        </div>

        <div class="form-info-text">
            Обратите внимание, что аренда автомобиля подразумевает ответственность за его сохранность.
            При возврате автомобиля в ненадлежащем состоянии могут быть применены штрафы.
        </div>

        <div class="rental-form-actions">
            <a href="{% url 'vehicle_list' %}" class="btn btn-secondary">Назад к списку автомобилей</a>
            <button type="submit" class="btn btn-primary">{% if is_update %}Сохранить{% else %}Добавить в корзину{% endif %}</button>
        </div>
    </form>
</div>

<div id="vehicle-prices" data-prices="{{ vehicle_prices_json }}" style="display: none;"></div>
<div id="promo-percentages" data-percentages="{{ promo_percentages_json }}" style="display: none;"></div>

<script src="{% static 'js/rental_price_calculator.js' %}"></script>
{% endblock %}
